PA EQU 30H
PB EQU 31H
CA EQU 32H
CB EQU 33H
DATO EQU 40H
ESTADO EQU 41H

ORG 1000H
MSJ DB "CADP"
FIN DB "0"

ORG 3000H
IMPRIMIR: MOV AL, [BX]
          OUT PB, AL
RET

ORG 3100H
STROBE: IN AL, PA
        OR AL, 02H
        OUT PA, AL

        IN AL, PA
        AND AL, 1
        OUT PA, AL
RET

ORG 3200H
IMPRIMIR2: PUSH BX
           MOV BX, OFFSET FIN
           MOV AL, [BX]
           CALL IMPRIMIR
           CALL STROBE
           POP BX
RET

ORG 2000H
MOV AL, 11111101B
OUT CA, AL
MOV AL, 0
OUT CB, AL
MOV BX, OFFSET MSJ
MOV CL, 4
MOV DL, FIN
POLL: IN AL, PA
      AND AL, 1
      JNZ POLL
ACA: CALL IMPRIMIR
     CALL STROBE
     CALL IMPRIMIR2
     INC BX
     DEC CL
     JNZ ACA

INT 0
END
